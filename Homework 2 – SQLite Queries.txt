Homework 2 â€“ SQLite Queries

Q1. Find the genre which has at most 1 track. Print the name of such genre.
Number of rows returned in the result = 1

A:
SELECT G.Name 
FROM Genre G, Track T
WHERE G.GenreId = T.GenreId
GROUP BY G.GenreId 
HAVING COUNT(*) < 2
;


Q2. Find the tracks that were purchased in California (CA) or Washington (WA). Print the name of
such tracks.
Number of rows returned in the result = 151

A:  
SELECT DISTINCT T.Name
FROM Invoice I, Track T
WHERE I.BillingState='CA' OR I.BillingState='WA'
;


Q3. Find the tracks that have been purchased in quantities greater than 5. Print the name of such
tracks.
Number of rows returned in the result = 0

A: 
SELECT T.Name
FROM Track T, InvoiceLine IL
WHERE T.TrackId =  
(
SELECT IL.TrackId
FROM InvoiceLine IL
GROUP BY IL.TrackId
HAVING COUNT(IL.TrackId) > 5
)
;


Q4. Find the tracks which cost less than a dollar but the track length (Milliseconds) is more than the
average track length in this database. Print the name of such tracks.
Number of rows returned in the result = 282

A: 
SELECT T1.Name
FROM Track T1
WHERE T1.UnitPrice < 1 AND T1.MilliSeconds > (SELECT AVG(T2.MilliSeconds) 
FROM Track T2)
;


Q5. Find the playlists which have one or more tracks that have never been purchased. Print the Id,
and the name of such playlists.
Number of rows returned in the result = 14

A: 
SELECT P.PlaylistId, P.Name
FROM Playlist P
WHERE P.PlaylistId
IN
( SELECT DISTINCT PT.PlaylistId
FROM PlaylistTrack PT
WHERE EXISTS
(SELECT T.TrackId FROM Track T WHERE  T.TrackId=PT.TrackId
EXCEPT SELECT IL.TrackId FROM InvoiceLine IL) )
;


Q6. Find the playlists where the composer is not specified for 10 or more tracks. Print the Id, and the
name of such playlists.
Number of rows returned in the result = 6

A: 
SELECT P.PlaylistId, P.Name
FROM Playlist P
WHERE P.PlaylistId IN ( SELECT PT.PlaylistId
FROM PlaylistTrack PT
WHERE EXISTS (SELECT T.Composer
FROM Track T, PlaylistTrack PT
WHERE T.Composer IS NULL AND T.TrackId = PT.TrackId
GROUP BY T.Composer
HAVING COUNT(T.Composer)>10) )

		 
Q7. Find the playlists with 50 or more composers. Print the Id, and the name of such playlists. Tracks
with no composer (null) should not be considered.
Number of rows returned in the result = 4	

A: 		
SELECT PT.PlaylistId
FROM  PlaylistTrack PT
WHERE PT.TrackId 
IN
(SELECT T.TrackId
FROM PlaylistTrack PT, Track T
WHERE T.TrackId=PT.TrackId AND T.Composer IS NOT NULL
GROUP BY T.Composer
HAVING COUNT(DISTINCT T.Composer)>50)
;


Q8. Find all the customers who have invoice total greater than 5.65. Print the first and last name,
postal code, and invoice total for such customers.
Number of rows returned in the result = 179  

A:
SELECT C.FirstName, C.LastName, C.PostalCode, I.Total
FROM Customer C, Invoice I
WHERE I.Total >5.65 AND  C.CustomerId = I.CustomerId
;


Q9. Find all the Employees to whom no other employee reports to. Print the Id, and the first and last
name of such employees.
Number of rows returned in the result = 5

A:
SELECT E.EmployeeId, E.FirstName, E.LastName
FROM Employee E
WHERE E.EmployeeId IN
(
SELECT E1.EmployeeId 
FROM Employee E1 
EXCEPT 
SELECT DISTINCT E2.ReportsTo
FROM Employee E2
)
;

Extra Credit Queries 

Q1. Find the media type which has 100 or more tracks. Print the name of such media type.
Number of rows returned in the result = 3

A: 
SELECT MT.Name
FROM MediaType MT
WHERE MT.MediaTypeId IN
(
SELECT T.MediaTypeId
FROM Track T
GROUP BY T.MediaTypeId
HAVING COUNT(T.MediaTypeId)>100
)
;


Q2. Find the playlists which have one or more tracks that have never been purchased in California (CA).
Print the Id, and the name of such playlists.
Number of rows returned in the result = 18

A: SELECT DISTINCT PT.PlaylistId, P.Name
FROM PlaylistTrack PT, Playlist P
WHERE PT.PlaylistId=P.PlaylistId AND EXISTS
(
SELECT DISTINCT TrackId FROM Track T
EXCEPT
SELECT DISTINCT IL.TrackId
FROM Invoice I, InvoiceLine IL
WHERE I.InvoiceId=IL.InvoiceId AND I.BillingState='CA'
)
;


Q3. Find the customers who have invoice total greater than the average invoice total. Print the first and
last name, postal code, and invoice total of such customers.
Number of rows returned in the result = 179

A: SELECT C.FirstName, C.LastName, C.PostalCode, I.Total
FROM Customer C, Invoice I
WHERE C.CustomerId=I.CustomerId AND I.Total>(SELECT AVG(I.Total) AS AvgInvoice
FROM Invoice I)
;


Q4. Find the employees to whom at least two other employee reports to. Print the Id, and first and last
name of such employees.
Number of rows returned in the result = 3

A: 
SELECT E.EmployeeId, E.FirstName, E.LastName
FROM Employee E
GROUP BY E.ReportsTo
HAVING COUNT(E.ReportsTo)>=2


Q5. Find the artists that have tracks in the 'Rock' genre. Print the Id, and name of such artists.
Number of rows returned in the result = 51

A: SELECT DISTINCT A.ArtistId, A.Name
FROM Album AL, Artist A
WHERE A.ArtistId=AL.ArtistId AND AL.AlbumId IN
(
SELECT T.AlbumId
FROM Genre G, Track T
WHERE G.Name='Rock' AND G.GenreId=T.GenreId
)
;


Q6. Find the artists who have recorded more than 10 albums. Print the Id, and name of such artists. Also
print the number of albums for such artists.
Number of rows returned in the result = 3

A: SELECT A.ArtistId, A.Name
FROM Artist A
WHERE A.ArtistId IN
(
SELECT AL.ArtistId
FROM Album AL
GROUP BY ArtistId
HAVING COUNT(AL.ArtistId)>10
)
;


Q7. Find the customers who are served by support representatives based in the same State as the
customer. Print the first and last name of the customer and the support representative, and the
State in which they are located.
Number of rows returned in the result = 1

A: SELECT C.FirstName, C.LastName, C.State, E.FirstName, E.LastName, E.State
FROM Customer C, Employee E
WHERE E.EmployeeId=C.SupportRepId AND C.State=E.State 
;


Q8. Find the albums that have more than 5 tracks. Print the Id, and the title of such album. Also print the
number of tracks in each album.
Number of rows returned in the result = 250

A: SELECT DISTINCT AL.AlbumId, AL.Title, COUNT(T.AlbumId) AS NumberOfTracks
FROM Track T, Album AL
WHERE AL.AlbumId=T.AlbumId
GROUP BY T.AlbumId
HAVING COUNT(T.AlbumId)>5
;


Q9. Modify the above query to output the number of albums that have more than 5 tracks.
Number of rows returned in the result = 1

A: SELECT COUNT(*) AS NumberOfAlbums FROM
(
SELECT DISTINCT AL.AlbumId, AL.Title, COUNT(T.AlbumId) AS NumberOfTracks
FROM Track T, Album AL
WHERE AL.AlbumId=T.AlbumId
GROUP BY T.AlbumId
HAVING COUNT(T.AlbumId)>5
)
;


Q10. Find the artists that have tracks in 2 or more genres. Print the Id, and name of such artists.
Number of rows returned in the result = 7

A: SELECT DISTINCT  A.ArtistId, A.Name
FROM Artist A
WHERE A.ArtistId IN
(
SELECT DISTINCT AL.ArtistId
FROM Track T, Album AL
WHERE T.AlbumId=AL.AlbumId 
GROUP BY T.GenreId
HAVING COUNT(T.GenreId) >= 2
)
;
